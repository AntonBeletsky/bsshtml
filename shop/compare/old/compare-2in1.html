<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
<!-- -----------------------CSS----------------------- -->
<!--  icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<!-- Boostrap icons  -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

<!-- Fotorama Gallery -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/fotorama/4.6.4/fotorama.css" rel="stylesheet">



<!-- Font Awesome Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"
    integrity="sha512-5A8nwdMOWrSz20fDsjczgUidUBR8liPYU+WymTZP1lmY9G6Oc7HlZv156XqnsgNUzTyMefFTcsFH/tnJE/+xBg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

<!-- Material UI icons -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<!-- Material Symbols Outlined -->
<link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=grid_view" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>boostrap-lux-shop-master</title>
    <link rel="stylesheet" href="../../../assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@200;300;400;500;600;700&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,700&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Condensed&amp;display=swap">
    <link rel="stylesheet" href="../../../assets/css/articles-badges-images.css">
    <link rel="stylesheet" href="../../../assets/css/basket.css">
    <link rel="stylesheet" href="../../../assets/css/body.css">
    <link rel="stylesheet" href="../../../assets/css/bootstrap-extension.css">
    <link rel="stylesheet" href="../../../assets/css/catalog-page.css">
    <link rel="stylesheet" href="../../../assets/css/checkout.css">
    <link rel="stylesheet" href="../../../assets/css/compare-page.css">
    <link rel="stylesheet" href="../../../assets/css/customer-account.css">
    <link rel="stylesheet" href="../../../assets/css/dialog.css">
    <link rel="stylesheet" href="../../../assets/css/featured-Itemn.css">
    <link rel="stylesheet" href="../../../assets/css/fotorama.css">
    <link rel="stylesheet" href="../../../assets/css/header-1.css">
    <link rel="stylesheet" href="../../../assets/css/header-navbar-black.css">
    <link rel="stylesheet" href="../../../assets/css/home-page.css">
    <link rel="stylesheet" href="../../../assets/css/img.css">
    <link rel="stylesheet" href="../../../assets/css/index-page.css">
    <link rel="stylesheet" href="../../../assets/css/main.css">
    <link rel="stylesheet" href="../../../assets/css/order-item.css">
    <link rel="stylesheet" href="../../../assets/css/popover-content.css">
    <link rel="stylesheet" href="../../../assets/css/product-card-grid.css">
    <link rel="stylesheet" href="../../../assets/css/product-card-list.css">
    <link rel="stylesheet" href="../../../assets/css/product-page.css">
    <link rel="stylesheet" href="../../../assets/css/products-carousel.css">
    <link rel="stylesheet" href="../../../assets/css/scroll-normalizer-master.css">
    <link rel="stylesheet" href="../../../assets/css/shadow-box.css">
    <link rel="stylesheet" href="../../../assets/css/shopping-cart.css">
    <link rel="stylesheet" href="../../../assets/css/slider-price.css">
    <link rel="stylesheet" href="../../../assets/css/stars-rating.css">
    <link rel="stylesheet" href="../../../assets/css/tech-shadow-box.css">
    <link rel="stylesheet" href="../../../assets/css/timeline.css">
    <link rel="stylesheet" href="../../../assets/css/ui-collapsible-panel.css">
    <link rel="stylesheet" href="../../../assets/css/ui-icons-circle.css">
    <link rel="stylesheet" href="../../../assets/css/wishlist.css">
</head>

<body>

    <style>
        /* CSS Переменные для легкой кастомизации */
        :root {
            --header-bg-color: #f8f9fa;
            --sticky-header-bg-color: #e9ecef;
            --sticky-col-bg-color: #f8f9fa;
            --highlight-bg-color: #fff3cd;
            --product-card-min-width: 240px;
            --product-image-max-width: 140px;
        }

        body {
            background-color: var(--header-bg-color);
        }

        .comparison-container {
            margin-top: 30px;
        }

        /* Контейнер для таблицы с вертикальным скроллом, если нужно */
        .table-responsive {
            max-height: 90vh;
            overflow: auto; /* Важно для работы sticky-элементов */
        }

        /* --- Стили для "липких" (sticky) элементов --- */
        /* Первая колонка с характеристиками */
        .table th:first-child,
        .table td:first-child {
            position: sticky;
            left: 0;
            z-index: 2;
            background-color: var(--sticky-col-bg-color);
            min-width: 220px;
        }
        /* Шапка таблицы */
        .table thead th {
            position: sticky;
            top: 0;
            z-index: 3;
            background-color: var(--sticky-header-bg-color);
        }
        /* Угол, который должен быть поверх всего */
        .table thead th:first-child {
            z-index: 4;
        }


        /* --- Стилизация карточки товара в шапке --- */
        .product-card {
            min-width: var(--product-card-min-width);
            text-align: center;
            padding: 10px;
        }
        .product-card img {
            max-width: var(--product-image-max-width);
            height: auto;
            margin-bottom: 15px;
            aspect-ratio: 1 / 1;
            object-fit: contain;
        }
        .product-card .product-name {
            font-size: 1rem;
            font-weight: bold;
            height: 50px; /* Фиксированная высота для выравнивания */
            margin-bottom: 10px;
        }
        .product-card .product-price {
            font-size: 1.2rem;
            font-weight: bold;
            color: #d9534f;
            margin: 10px 0;
        }
        .star-rating {
            color: #ffc107;
            margin-bottom: 10px;
        }
        .star-rating .bi-star {
            color: #e0e0e0;
        }


        /* --- Стили для Drag-and-Drop --- */
        .drag-handle {
            cursor: grab;
            color: #6c757d;
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
        }
        .drag-handle:active {
            cursor: grabbing;
        }
        th.dragging {
            opacity: 0.5;
            background: #d0eaff;
        }
        th.drag-over {
            outline: 2px dashed #0d6efd;
        }

        /* --- Другие стили --- */
        .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
        }
        .highlight-diff {
            background-color: var(--highlight-bg-color) !important;
        }
        .actions-panel {
            min-height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

    </style>


<div class="container-fluid comparison-container">
    <h1 class="mb-4 text-center">Ультимативное Сравнение Товаров</h1>

    <div class="table-responsive shadow rounded">
        <table class="table table-bordered table-hover align-middle text-center" id="comparison-table">
            <thead class="table-light">
                <tr>
                    <th scope="col">
                        <div class="actions-panel p-3">
                            <h5 class="mb-4">Характеристики</h5>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" id="show-diff-switch">
                                <label class="form-check-label" for="show-diff-switch">Только различия</label>
                            </div>
                        </div>
                    </th>
                    <th scope="col" draggable="true" data-col-index="1">
                        <div class="product-card position-relative">
                            <i class="bi bi-grip-horizontal drag-handle fs-4" title="Перетащить"></i>
                            <button class="btn btn-sm btn-outline-danger remove-btn" title="Удалить">
                                <i class="bi bi-x-lg"></i>
                            </button>
                            <img src="https://elmir.ua/img/156/108472/1283/ssd_nakopitel_m_2_2280_2tb_kingston_nv2_snv2s_2000g.jpg" alt="Kingston NV2">
                            <div class="product-name">SSD M.2 2TB Kingston NV2</div>
                            <div class="star-rating">
                                <i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star"></i>
                            </div>
                            <div class="product-price">4 799 грн</div>
                            <button class="btn btn-primary w-100">Купить</button>
                        </div>
                    </th>
                     <th scope="col" draggable="true" data-col-index="2">
                        <div class="product-card position-relative">
                            <i class="bi bi-grip-horizontal drag-handle fs-4" title="Перетащить"></i>
                            <button class="btn btn-sm btn-outline-danger remove-btn" title="Удалить">
                                <i class="bi bi-x-lg"></i>
                            </button>
                            <img src="https://elmir.ua/img/156/108472/359/ssd_nakopitel_m_2_2280_2tb_samsung_980_pro_v-nand_mlc_mz-v8p2t0bw.jpg" alt="Samsung 980 Pro">
                            <div class="product-name">SSD M.2 2TB Samsung 980 Pro</div>
                             <div class="star-rating">
                                <i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-half"></i>
                            </div>
                            <div class="product-price">8 359 грн</div>
                            <button class="btn btn-primary w-100">Купить</button>
                        </div>
                    </th>
                    <th scope="col" draggable="true" data-col-index="3">
                        <div class="product-card position-relative">
                            <i class="bi bi-grip-horizontal drag-handle fs-4" title="Перетащить"></i>
                            <button class="btn btn-sm btn-outline-danger remove-btn" title="Удалить">
                                <i class="bi bi-x-lg"></i>
                            </button>
                            <img src="https://elmir.ua/img/156/108472/851/ssd_nakopitel_m_2_2280_2tb_crucial_p3_plus_ct2000p3pssd8.jpg" alt="Crucial P3 Plus">
                            <div class="product-name">SSD M.2 2TB Crucial P3 Plus</div>
                             <div class="star-rating">
                                <i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star"></i>
                            </div>
                            <div class="product-price">4 759 грн</div>
                            <button class="btn btn-primary w-100">Купить</button>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr class="table-group-divider">
                    <td colspan="4" class="fw-bold bg-light text-start ps-3">Основные</td>
                </tr>
                <tr>
                    <th scope="row" class="text-start ps-3">Объем накопителя</th>
                    <td>2 ТБ</td>
                    <td>2 ТБ</td>
                    <td>2 ТБ</td>
                </tr>
                <tr>
                    <th scope="row" class="text-start ps-3">Тип ячеек памяти</th>
                    <td>TLC 3D</td>
                    <td>V-NAND 3-bit MLC</td>
                    <td>3D QLC NAND</td>
                </tr>
                 <tr class="table-group-divider">
                    <td colspan="4" class="fw-bold bg-light text-start ps-3">Скорость</td>
                </tr>
                 <tr>
                    <th scope="row" class="text-start ps-3">Скорость чтения, макс.</th>
                    <td>3500 МБ/с</td>
                    <td>7000 МБ/с</td>
                    <td>5000 МБ/с</td>
                </tr>
                <tr>
                    <th scope="row" class="text-start ps-3">Скорость записи, макс.</th>
                    <td>2800 МБ/с</td>
                    <td>5100 МБ/с</td>
                    <td>4200 МБ/с</td>
                </tr>
                 <tr class="table-group-divider">
                    <td colspan="4" class="fw-bold bg-light text-start ps-3">Надёжность</td>
                </tr>
                <tr>
                    <th scope="row" class="text-start ps-3">TBW (Total Bytes Written)</th>
                    <td>640 ТБ</td>
                    <td>1200 ТБ</td>
                    <td>440 ТБ</td>
                </tr>
                <tr>
                    <th scope="row" class="text-start ps-3">Гарантия</th>
                    <td>36 мес.</td>
                    <td>60 мес.</td>
                    <td>60 мес.</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const table = document.getElementById('comparison-table');
    const showDiffSwitch = document.getElementById('show-diff-switch');

    // --- ФУНКЦИИ УПРАВЛЕНИЯ ТАБЛИЦЕЙ ---

    // Функция переиндексации колонок (важно после удаления или перетаскивания)
    function reindexColumns() {
        const headers = table.querySelectorAll('thead th[data-col-index]');
        headers.forEach((header, index) => {
            header.setAttribute('data-col-index', index + 1);
        });
    }

    // Функция для подсветки различий
    function highlightDifferences() {
        const rows = table.querySelectorAll('tbody tr');
        rows.forEach(row => {
            // Очищаем предыдущие подсветки и маркеры
            row.removeAttribute('data-has-diff');
            row.querySelectorAll('td.highlight-diff').forEach(cell => cell.classList.remove('highlight-diff'));

            // Пропускаем строки-разделители
            if (row.cells.length <= 2) return;

            const dataCells = Array.from(row.cells).slice(1);
            if (dataCells.length === 0) return;

            const firstValue = dataCells[0].textContent.trim();
            let allSame = true;

            // Проверяем, есть ли хотя бы одно отличие в строке
            for (let i = 1; i < dataCells.length; i++) {
                if (dataCells[i].textContent.trim() !== firstValue) {
                    allSame = false;
                    break;
                }
            }

            // Если есть различия, помечаем строку и добавляем класс ячейкам
            if (!allSame) {
                row.dataset.hasDiff = 'true';
                dataCells.forEach(cell => {
                    cell.classList.add('highlight-diff');
                });
            }
        });
    }

    // Функция для фильтрации строк
    function toggleDifferenceView() {
        const rows = table.querySelectorAll('tbody tr');
        rows.forEach(row => {
            // Пропускаем строки-разделители
            if (row.cells.length <= 2) return;

            if (showDiffSwitch.checked && row.dataset.hasDiff !== 'true') {
                row.style.display = 'none';
            } else {
                row.style.display = '';
            }
        });
    }

    // Функция для удаления колонки
    function removeColumn(columnIndex) {
        if (table.rows[0].cells.length <= 2) {
            alert('Нельзя удалить последний товар для сравнения.');
            return;
        }

        for (let i = 0; i < table.rows.length; i++) {
            if(table.rows[i].cells[columnIndex]) {
                table.rows[i].deleteCell(columnIndex);
            }
        }
        reindexColumns();
        highlightDifferences(); // Пересчитываем различия после удаления
        toggleDifferenceView(); // Применяем фильтр, если он активен
    }


    // --- ЛОГИКА DRAG AND DROP ---

    let draggedColumn = null;

    table.addEventListener('dragstart', (e) => {
        // Драг начинается только с "ручки"
        if (e.target.classList.contains('drag-handle')) {
            draggedColumn = e.target.closest('th');
            draggedColumn.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        } else {
            // Запрещаем драг для других элементов
            e.preventDefault();
        }
    });

    table.addEventListener('dragover', (e) => {
        e.preventDefault();
        const targetColumn = e.target.closest('th');
        if (targetColumn && targetColumn !== draggedColumn && targetColumn.hasAttribute('data-col-index')) {
            // Убираем подсветку с предыдущих целей
             table.querySelectorAll('th.drag-over').forEach(th => th.classList.remove('drag-over'));
            targetColumn.classList.add('drag-over');
            e.dataTransfer.dropEffect = 'move';
        }
    });

    table.addEventListener('dragleave', (e) => {
        const targetColumn = e.target.closest('th');
         if (targetColumn) {
            targetColumn.classList.remove('drag-over');
         }
    });

    table.addEventListener('drop', (e) => {
        e.preventDefault();
        const targetColumn = e.target.closest('th');
        if (targetColumn && draggedColumn && targetColumn !== draggedColumn && targetColumn.hasAttribute('data-col-index')) {
            const draggedIndex = draggedColumn.cellIndex;
            const targetIndex = targetColumn.cellIndex;

            // Перемещаем ячейки в каждой строке таблицы
            for (const row of table.rows) {
                 const cellToMove = row.cells[draggedIndex];
                 const targetCell = row.cells[targetIndex];
                 // Если перемещаем вперед, вставляем перед следующей ячейкой, иначе просто перед целевой
                 if (draggedIndex < targetIndex) {
                     targetCell.parentNode.insertBefore(cellToMove, targetCell.nextSibling);
                 } else {
                      targetCell.parentNode.insertBefore(cellToMove, targetCell);
                 }
            }

            reindexColumns();
            highlightDifferences();
        }
        // Очистка классов
        draggedColumn.classList.remove('dragging');
        table.querySelectorAll('th.drag-over').forEach(th => th.classList.remove('drag-over'));
        draggedColumn = null;
    });

    table.addEventListener('dragend', () => {
        if(draggedColumn) {
            draggedColumn.classList.remove('dragging');
        }
        table.querySelectorAll('th.drag-over').forEach(th => th.classList.remove('drag-over'));
        draggedColumn = null;
    });


    // --- ИНИЦИАЛИЗАЦИЯ И ОБРАБОТЧИКИ ---

    // Навешиваем обработчики событий (используем делегирование для кнопок удаления)
    table.addEventListener('click', (e) => {
        const removeButton = e.target.closest('.remove-btn');
        if (removeButton) {
            const header = removeButton.closest('th');
            if(header) {
                 // columnIndex - это физический индекс ячейки в строке
                removeColumn(header.cellIndex);
            }
        }
    });

    showDiffSwitch.addEventListener('change', toggleDifferenceView);

    // Первоначальный запуск
    highlightDifferences();
});
</script>


    <script src="../../../assets/js/jquery.min.js"></script>
    <script src="../../../assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="../../../assets/js/bs-init.js"></script>
    <script src="../../../assets/js/add-theme-changer-button.js"></script>
    <script src="../../../assets/js/catalog-page.js"></script>
    <script src="../../../assets/js/checkout.js"></script>
    <script src="../../../assets/js/home-page-carusel.js"></script>
    <script src="../../../assets/js/import/fotorama.js"></script>
    <script src="../../../assets/js/main-header.js"></script>
    <script src="../../../assets/js/product-page-sticky-nav-version.js"></script>
    <script src="../../../assets/js/products-carousel.js"></script>
    <script src="../../../assets/js/shopping-cart.js"></script>
    <script src="../../../assets/js/slider-price.js"></script>
</body>

</html>